 <!doctype html>
 <html>
   <head>
     <title>Isaac Flath</title>
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<script src="https://unpkg.com/htmx.org@2.0.4/dist/htmx.min.js"></script><script src="https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js"></script><script src="https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js"></script><script src="https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js"></script><script src="https://unpkg.com/@tailwindcss/browser@4"></script>     <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
   </head>
   <body>
     <div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
      const menuToggle = document.getElementById('menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (menuToggle && mobileMenu) {
        // Set initial state explicitly
        mobileMenu.style.display = 'none';
        
        // Handle click events
        menuToggle.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          console.log('Menu toggle clicked');
          
          // Toggle menu visibility
          if (mobileMenu.style.display === 'block') {
            console.log('Hiding menu');
            mobileMenu.style.display = 'none';
            menuToggle.classList.remove('is-active');
            menuToggle.setAttribute('aria-expanded', 'false');
          } else {
            console.log('Showing menu');
            mobileMenu.style.display = 'block';
            menuToggle.classList.add('is-active');
            menuToggle.setAttribute('aria-expanded', 'true');
          }
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
          if (!mobileMenu.contains(e.target) && !menuToggle.contains(e.target) && mobileMenu.style.display === 'block') {
            mobileMenu.style.display = 'none';
            menuToggle.classList.remove('is-active');
            menuToggle.setAttribute('aria-expanded', 'false');
          }
        });
      } else {
        console.error('Menu elements not found:', { menuToggle, mobileMenu });
      }
    });
    </script>       <style>
    /* Hamburger icon animation */
    .is-active .hamburger-line:nth-child(1) {
      transform: translateY(8px) rotate(45deg);
    }
    
    .is-active .hamburger-line:nth-child(2) {
      opacity: 0;
    }
    
    .is-active .hamburger-line:nth-child(3) {
      transform: translateY(-8px) rotate(-45deg);
    }
    
    #mobile-menu {
      display: none;
      z-index: 9999 !important;
      visibility: visible !important;
      opacity: 1 !important;
      background-color: white !important;
      position: absolute !important;
      top: 100% !important;
      left: 0 !important;
      width: 100% !important;
    }
    </style>
       <div class="bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 top-0 z-50 border-b border-indigo-100 shadow-[0_2px_10px_rgba(165,180,252,0.15)] relative">
         <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center relative z-40">
<a href="/" class="text-3xl font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-yellow-400 text-transparent bg-clip-text hover:scale-105 transform transition-all duration-300 hover:drop-shadow-[0_0_8px_rgba(165,180,252,0.5)]">Isaac Flath</a>           <div class="hidden md:flex items-center gap-x-8">
<a href="/" class="relative px-4 py-2 text-cyan-600 hover:text-cyan-800 transition-all duration-300 hover:scale-110 after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-full after:h-0.5 after:bg-gradient-to-r after:from-cyan-400 after:to-purple-400 after:scale-x-0 hover:after:scale-x-100 after:transition-transform after:duration-300">About</a><a href="/blog" class="relative px-4 py-2 text-yellow-600 hover:text-yellow-800 transition-all duration-300 hover:scale-110 after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-full after:h-0.5 after:bg-gradient-to-r after:from-yellow-400 after:to-cyan-400 after:scale-x-0 hover:after:scale-x-100 after:transition-transform after:duration-300">Blog</a><a href="/feed" class="relative px-4 py-2 text-orange-600 hover:text-orange-800 transition-all duration-300 hover:scale-110 after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-full after:h-0.5 after:bg-gradient-to-r after:from-orange-400 after:to-red-400 after:scale-x-0 hover:after:scale-x-100 after:transition-transform after:duration-300">RSS</a><form enctype="multipart/form-data" action="https://app.kit.com/forms/7782268/subscriptions" method="post" data-sv-form="7782268" data-uid="33bc264078" data-format="inline" data-version="5" class="seva-form formkit-form">               <div class="flex ml-8">
                 <input type="email" name="email_address" placeholder="Enter email" required class="w-48 px-3 py-2 rounded-l-lg border border-r-0 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent">
<button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-r-lg hover:bg-indigo-700 transition-colors duration-200">Subscribe</button>               </div>
</form>           </div>
<button aria-expanded="false" aria-label="Toggle menu" type="button" id="menu-toggle" class="md:hidden p-3 rounded-lg hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition-all duration-300" name="menu-toggle">             <div class="flex flex-col justify-center items-center">
               <div class="w-6 h-0.5 bg-indigo-600 mb-1.5 transition-all duration-300 hamburger-line"></div>
               <div class="w-6 h-0.5 bg-indigo-600 mb-1.5 transition-all duration-300 hamburger-line"></div>
               <div class="w-6 h-0.5 bg-indigo-600 transition-all duration-300 hamburger-line"></div>
             </div>
</button>         </div>
         <div id="mobile-menu" class="md:hidden absolute top-full left-0 w-full bg-white border-b border-indigo-100 shadow-lg z-50 rounded-b-lg">
<a href="/" class="block w-full py-4 px-6 text-lg text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 transition-colors duration-300 border-b border-indigo-50">About</a><a href="/blog" class="block w-full py-4 px-6 text-lg text-yellow-600 hover:text-yellow-800 hover:bg-indigo-50 transition-colors duration-300 border-b border-indigo-50">Blog</a><a href="/feed" class="block w-full py-4 px-6 text-lg text-orange-600 hover:text-orange-800 hover:bg-indigo-50 transition-colors duration-300 border-b border-indigo-50">RSS</a>           <div class="p-6">
<form enctype="multipart/form-data" action="https://app.kit.com/forms/7782268/subscriptions" method="post" data-sv-form="7782268" data-uid="33bc264078" data-format="inline" data-version="5" class="seva-form formkit-form">               <div class="w-full">
                 <input type="email" name="email_address" placeholder="Enter email" required class="w-full px-4 py-2 mb-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400">
<button type="submit" class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200">Subscribe</button>               </div>
</form>           </div>
         </div>
       </div>
       <div>
         <div class="max-w-6xl mx-auto px-4 py-8">
           <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
           <link rel="stylesheet" href="/static/prism.css">
           <link rel="stylesheet" href="/static/blog_styles.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>           <div class="mb-8">
             <meta property="og:type" content="article">
             <meta property="og:url" content="https://isaacflath.com/blog/blog_post?fpath=posts%2F2025-03-17-Retrieval101.ipynb">
             <meta property="og:title" content="Retrieval 101">
             <meta property="og:description" content="A practical guide to implementing semantic search for technical content">
             <meta property="og:site_name" content="Isaac Flath's Blog">
             <meta name="twitter:card" content="summary_large_image">
             <meta name="twitter:title" content="Retrieval 101">
             <meta name="twitter:description" content="A practical guide to implementing semantic search for technical content">
             <meta property="article:published_time" content="2025-03-17">
             <meta property="article:author" content="Isaac Flath">
             <meta property="article:tag" content="RAG">
             <meta property="article:tag" content="retrieval">
             <meta property="article:tag" content="vector-search">
             <meta property="article:tag" content="semantic-search">
             <meta property="article:tag" content="embeddings">
             <link rel="canonical" href="https://isaacflath.com/blog/blog_post?fpath=posts%2F2025-03-17-Retrieval101.ipynb">
             <meta property="og:image" content="static/thumbnail_imgs/basic_rag.webp">
             <meta name="twitter:image" content="static/thumbnail_imgs/basic_rag.webp">
             <h1 class="gradient-text-primary text-4xl font-bold mb-4">Retrieval 101</h1>
             <p class="text-xl text-gray-600 leading-relaxed">A practical guide to implementing semantic search for technical content</p>
           </div>
           <div>
<script src="https://cdn.jsdelivr.net/gh/cferdinandi/gumshoe/dist/gumshoe.polyfills.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        document.querySelectorAll('#toc-list a').forEach(link => {
                            const isActive = link.getAttribute('href') === '#' + id;
                            link.style.color = isActive ? '#4F46E5' : '#4B5563';
                            link.style.fontWeight = isActive ? '600' : '400';
                            link.style.borderLeftColor = isActive ? '#4F46E5' : 'transparent';
                        });
                    }
                });
            }, { threshold: 0.1 });

            // Observe all section headings
            document.querySelectorAll('span[id]').forEach(section => observer.observe(section));

            // Handle smooth scrolling
            document.querySelectorAll('#toc-list a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelector(link.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
        });
    </script>             <div class="lg:hidden mb-8">
               <div class="
            bg-gray-50 rounded-xl p-6
            border border-gray-200
            max-h-[calc(100vh-2rem)] overflow-y-auto
        ">
                 <h2 class="text-lg font-medium text-gray-900 mb-4">Contents</h2>
                 <div id="toc-list" class="space-y-1 border-l-2 border-gray-200">
<a href="#the-challenge-of-finding-relevant-content" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">The Challenge of Finding Relevant Content</a><a href="#what-this-post-will-deliver" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">What This Post Will Deliver</a><a href="#vector-embeddings-the-key-to-semantic-search" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Vector Embeddings: The Key to Semantic Search</a><a href="#initial-solution-attempt-setting-up-lancedb" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Initial Solution Attempt: Setting Up LanceDB</a><a href="#why-the-initial-approach-isnt-enough" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Why the Initial Approach Isn&#x27;t Enough</a><a href="#chunking" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Chunking</a><a href="#hybrid-search" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Hybrid Search</a><a href="#re-ranking" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Re-ranking</a><a href="#key-takeaways-and-principles" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Key Takeaways and Principles</a><a href="#next-steps" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Next Steps</a><a href="#extend-your-implementation" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-normal
                          ml-4
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Extend Your Implementation</a><a href="#resources-for-further-learning" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-normal
                          ml-4
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Resources for Further Learning</a><a href="#join-the-conversation" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-normal
                          ml-4
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Join the Conversation</a>                 </div>
               </div>
             </div>
             <div class="lg:flex lg:gap-8">
               <div class="lg:max-w-4xl">
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="the-challenge-of-finding-relevant-content">The Challenge of Finding Relevant Content</span></h1>
</div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">Have you ever spent hours writing a blog post only to have it disappear into the void? You're not alone. I spend a lot of time making detailed tutorials, explanations, and code examples, yet much of this content is hard to find.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">90% of users never venture past the first page of search results, and most scan only the top 3-5 entries before reformulating their query or abandoning the search altogether. For technical blogs, this problem is even more acute - the specialized vocabulary and conceptual relationships between topics make keyword matching particularly ineffective.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">Search solutions that rely solely on finding exact words will often have huge misses.  For example my post about custom tags for FastHTML may be be highly relevant to someone looking to use web components but web components is a term never mentioned directly in the blog post!</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">This disconnect creates a frustrating experience for both content creators and consumers.  Content creators have to spend time trying to jam in keywords to make things more discoverable, and readers struggle to find the solutions they're looking for.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">The question becomes: how can we make technical content discoverable by meaning rather than just keywords?</p>
</div></div>
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="what-this-post-will-deliver">What This Post Will Deliver</span></h1>
</div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">In this tutorial, you'll learn how to implement a semantic search system using LanceDB. Instead of relying on exact keyword matches, you'll be able to find content based on meaning and conceptual relationships.  We will go beyond the hello-world of "vector-search" and do a hybrid vector-search + keyword search approach and then re-rank final results with a cross-encoder.  By the end of this tutorial, you'll know what that means and how to implement it.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">By the end of this post, you'll have a complete solution that can:</p>
<ul class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-disc marker:text-indigo-400">
<li class="leading-relaxed pl-2">Find conceptually related blog posts even when they use different terminology</li>
<li class="leading-relaxed pl-2">Surface relevant technical content based on the intent behind a search query</li>
<li class="leading-relaxed pl-2">Provide more accurate and helpful search results to your readers</li>
</ul>
<p class="text-lg leading-relaxed mb-6 text-gray-800">Here's a quick preview of what we'll build:</p>
<pre class="bg-indigo-50 rounded-xl p-6 mb-6 shadow-inner overflow-x-auto border border-indigo-100"><code class="language-python bg-indigo-50 px-2 py-0.5 rounded-md text-indigo-700 font-mono text-sm bg-transparent p-0 text-gray-800 font-mono text-sm block"># A simple semantic search query that finds related content
query = "How do I make web components?"

results = blog_search.search(query, limit=3)

for result in results:
    print(f"Post: {result.metadata['title']}")
    print(f"Relevance score: {result.score:.2f}")

# Output:
# Post: Basic Testing in Python
# Relevance score: 0.87
#
# Post: Python Tips and Tricks
# Relevance score: 0.72
</code></pre>
<p class="text-lg leading-relaxed mb-6 text-gray-800">This isn't just theory - you'll implement this system step-by-step using real blog posts, and I'll show you how to adapt it to your own content. Whether you have a personal tech blog, manage documentation for a larger project, or have <em>anything</em> else you want people to be able to search, this approach will help your valuable content reach the right audience</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">This is the foundation of a modern retrieval system and I am hard-pressed to thing of an example where you want good semantic search but would not want this as the foundation.</p>
</div></div>
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="vector-embeddings-the-key-to-semantic-search">Vector Embeddings: The Key to Semantic Search</span></h1>
</div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">At the heart of semantic search is the concept of <strong>vector embeddings</strong>.  AI models cannot understand words directly so we have to convert everything to numbers to compare them programatically.  Let's take a simple example, maybe we give 3 words vector embeddings</p>
<ul class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-disc marker:text-indigo-400">
<li class="leading-relaxed pl-2">Cat    = [1.5, 2.5, 2.2]</li>
<li class="leading-relaxed pl-2">Dog    = [1.8, 2.6, 2.6]</li>
<li class="leading-relaxed pl-2">Animal = [1.6, 2.4, 2.4]</li>
<li class="leading-relaxed pl-2">Bog    = [0.1, 0.3, 5.9]</li>
</ul>
<p class="text-lg leading-relaxed mb-6 text-gray-800">You can see how using just the numbers Cat and Dog are more similar to Animal than they are to Bog.  What does each specific number mean?  I don't know - they don't map to human language!  Similar concepts end up close to each other in this space, even if they use different words.  That's what semantic search is.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">In a more targetted example, the phrases "how to test Python code" and "writing unit tests for Python functions" might use different words, but their vector embeddings would be very similar because they represent the same concept.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">This leads to the question: "How do you pick the numbers for each word, sentence, or article?".</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">Modern language models like BERT, GPT, and their derivatives can generate these embeddings by processing vast amounts of text and learning the relationships between words and concepts.  We can leverage those pre-existing models to generate these embeddings (training a new model to do this is out of the scope of this tutorial).</p>
</div></div>
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="initial-solution-attempt-setting-up-lancedb">Initial Solution Attempt: Setting Up LanceDB</span></h1>
</div>
                 <div class="code-section my-6">
                   <div class="code-fold-container my-6">
<button class="code-toggle-btn px-4 py-2 text-sm font-medium text-indigo-700 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-colors duration-200">                       <div class="flex items-center gap-2">
<span class="show-text">Show Code</span><span class="hide-text hidden">Hide Code</span>                       </div>
</button>                     <div class="code-content hidden mt-2">
                       <div class="code-block">
<pre class="code-block"><code class="language-python">from contextkit.read import read_url

def clean_post(content):
    parts = content.split(&#x27;\n# &#x27;)
    result = &#x27;# &#x27; + &#x27;\n# &#x27;.join(parts[1:])
    return result</code></pre>                       </div>
                     </div>
<script>
                document.addEventListener('DOMContentLoaded', function() {
                    const toggleBtns = document.querySelectorAll('.code-toggle-btn');
                    toggleBtns.forEach(btn => {
                        btn.addEventListener('click', function() {
                            const content = this.nextElementSibling;
                            const showText = this.querySelector('.show-text');
                            const hideText = this.querySelector('.hide-text');
                            content.classList.toggle('hidden');
                            showText.classList.toggle('hidden');
                            hideText.classList.toggle('hidden');
                        });
                    });
                });
            </script>                   </div>
                 </div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">fh_tutorial = clean_post(read_url(&#x27;https://isaac.up.railway.app/blog/blog_post?fpath=posts%2FFasthtmlTutorial.ipynb&#x27;))
ms_scratch = clean_post(read_url(&#x27;https://isaac.up.railway.app/blog/blog_post?fpath=posts%2FMeanShiftFromScratch.ipynb&#x27;))
py_tips = clean_post(read_url(&#x27;https://isaac.up.railway.app/blog/blog_post?fpath=posts%2FPython.ipynb&#x27;))
bas_test = clean_post(read_url(&#x27;https://isaac.up.railway.app/blog/blog_post?fpath=posts%2FBasicTesting.ipynb&#x27;))</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">We'll prepare our blog posts. For simplicity, we'll extract titles and content from our sample posts:</p>
</div>
                 <div class="prose-section my-4"><blockquote class="pl-6 border-l-4 border-gradient-to-b from-indigo-400 to-purple-400 
        italic mb-6 text-gray-700 py-2 bg-gradient-to-r from-purple-50 to-transparent">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Credit:</strong> This post was inspired by Ben Clavie's excellent work on semantic search implementations. His talk on RAG systems at <a href="https://parlance-labs.com/education/rag/ben.html" class="text-indigo-600 hover:text-indigo-800 underline decoration-2 decoration-indigo-200 hover:decoration-indigo-500 transition-all duration-300">a conference</a> provided many of the core concepts and techniques explored in this tutorial. I highly recommend checking out his original presentation for additional context and perspectives.  You will be glad you did - it is well worth the time.</p>
</blockquote>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">import pandas as pd
from sentence_transformers import SentenceTransformer
import lancedb</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">posts = [fh_tutorial, ms_scratch, py_tips, bas_test]
blog_data = [{&#x27;title&#x27;: post.split(&#x27;\n&#x27;)[0].replace(&#x27;# &#x27;, &#x27;&#x27;), &#x27;content&#x27;: post} for post in posts]
df = pd.DataFrame(blog_data)
df</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe 
        w-full mb-6 border-collapse border border-indigo-200 rounded-lg overflow-hidden
        bg-white shadow-sm">
  <thead>
    <tr style="text-align: right;">
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200"></th>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">title</th>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">0</th>
      <td class="p-4 border-b border-indigo-100 text-gray-700">Creating Custom FastHTML Tags for Markdown Ren...</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700"># Creating Custom FastHTML Tags for Markdown R...</td>
    </tr>
    <tr>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">1</th>
      <td class="p-4 border-b border-indigo-100 text-gray-700">MeanShift From Scratch</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700"># MeanShift From Scratch\n\nA deep dive on mea...</td>
    </tr>
    <tr>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">2</th>
      <td class="p-4 border-b border-indigo-100 text-gray-700">Python Programming Tips</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700"># Python Programming Tips\n\nA list of handy t...</td>
    </tr>
    <tr>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">3</th>
      <td class="p-4 border-b border-indigo-100 text-gray-700">Introduction To Statistical Testing</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700"># Introduction To Statistical Testing\n\nAn in...</td>
    </tr>
  </tbody>
</table>
</div></div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">The next thing we need is some sort of vector embedding for each post.  As mentioned before, we can us a pretrained model for this.</p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">model = SentenceTransformer(&quot;sentence-transformers/all-MiniLM-L6-v2&quot;)</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="prose-section my-4"><blockquote class="pl-6 border-l-4 border-gradient-to-b from-indigo-400 to-purple-400 
        italic mb-6 text-gray-700 py-2 bg-gradient-to-r from-purple-50 to-transparent">
<p class="text-lg leading-relaxed mb-6 text-gray-800">💡 One place to look for embedding models to use is the <a href="https://huggingface.co/spaces/mteb/leaderboard" class="text-indigo-600 hover:text-indigo-800 underline decoration-2 decoration-indigo-200 hover:decoration-indigo-500 transition-all duration-300">MTEB Leaderboard</a> <code class="bg-indigo-50 px-2 py-0.5 rounded-md text-indigo-700 font-mono text-sm">BEIR</code>.  Though be careful because many of the models are overfit to the leaderboard.</p>
</blockquote>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">df[&#x27;vector&#x27;] = df[&#x27;content&#x27;].apply(lambda x: model.encode(x, normalize_embeddings=True))</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">df.head()</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe 
        w-full mb-6 border-collapse border border-indigo-200 rounded-lg overflow-hidden
        bg-white shadow-sm">
  <thead>
    <tr style="text-align: right;">
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200"></th>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">title</th>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">content</th>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">vector</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">0</th>
      <td class="p-4 border-b border-indigo-100 text-gray-700">Creating Custom FastHTML Tags for Markdown Ren...</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700"># Creating Custom FastHTML Tags for Markdown R...</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700">[-0.0600754, 0.07570859, 0.0017243278, 0.00696...</td>
    </tr>
    <tr>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">1</th>
      <td class="p-4 border-b border-indigo-100 text-gray-700">MeanShift From Scratch</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700"># MeanShift From Scratch\n\nA deep dive on mea...</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700">[0.022285162, -0.03508064, -0.006767927, -0.04...</td>
    </tr>
    <tr>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">2</th>
      <td class="p-4 border-b border-indigo-100 text-gray-700">Python Programming Tips</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700"># Python Programming Tips\n\nA list of handy t...</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700">[-0.017614271, -0.015829531, -0.044863362, 0.0...</td>
    </tr>
    <tr>
      <th class="bg-gradient-to-r from-indigo-50 to-purple-50 
        p-4 text-left font-semibold text-indigo-700 border-b border-indigo-200">3</th>
      <td class="p-4 border-b border-indigo-100 text-gray-700">Introduction To Statistical Testing</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700"># Introduction To Statistical Testing\n\nAn in...</td>
      <td class="p-4 border-b border-indigo-100 text-gray-700">[-0.0035132996, -0.026535656, -0.10052579, 0.0...</td>
    </tr>
  </tbody>
</table>
</div></div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">We can load all that into our vector database, <code class="bg-indigo-50 px-2 py-0.5 rounded-md text-indigo-700 font-mono text-sm">lancedb</code>.</p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">db = lancedb.connect(&quot;./lancedb-tutorial&quot;)
table = db.create_table(&quot;blog_posts&quot;, data=df ,mode=&quot;overwrite&quot;)</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">Now, we're ready to use LanceDB to search.  There are a two main steps for this</p>
</div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>1. Create an embedding of your query or question</strong></p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">query = &quot;How do I make web components?&quot; # Get a query
query_embedding = model.encode(query) # Create an embedding of it
query_embedding.shape, query_embedding[:3] # 384 numbers representing the query</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4">
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">((384,), array([-0.01018321, -0.05370776, -0.08562952], dtype=float32))</p>
                       </div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>2. Compare Similarity</strong></p>
</div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">Now we can search the table to find most similar embeddings</p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">results = table.search(query_embedding).metric(&#x27;cosine&#x27;).to_pandas()
results[&#x27;_distance&#x27;]</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4">
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">0    0.585938
1    0.810537
2    0.951037
3    0.976564
Name: _distance, dtype: float32</p>
                       </div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><blockquote class="pl-6 border-l-4 border-gradient-to-b from-indigo-400 to-purple-400 
        italic mb-6 text-gray-700 py-2 bg-gradient-to-r from-purple-50 to-transparent">
<p class="text-lg leading-relaxed mb-6 text-gray-800">💡 Different models use different distance metrics.  This was trained with cosine similarity per the huggingface model card so I matched to that.</p>
</blockquote>
</div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>3. See Results</strong></p>
</div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">Now we can see which post is the most similar to the query based on those embeddings</p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">for _, row in results.iterrows():
    print(f&quot;Post: {row[&#x27;title&#x27;]}&quot;)
    print(f&quot;Distance: {row[&#x27;_distance&#x27;]:.2f}&quot;)</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4"><pre ><code class=''>Post: Creating Custom FastHTML Tags for Markdown Rendering
Distance: 0.59
Post: Python Programming Tips
Distance: 0.81
Post: Introduction To Statistical Testing
Distance: 0.95
Post: MeanShift From Scratch
Distance: 0.98
</code></pre></div>
                     </footer>
                   </article>
                 </div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">assert not &#x27;web component&#x27; in fh_tutorial.lower()</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">This basic implementation allows us to search our blog posts semantically. When we run a query like ""How do I make web components?", it will find the revelant post even though <code class="bg-indigo-50 px-2 py-0.5 rounded-md text-indigo-700 font-mono text-sm">web component</code> is not mentioned in the tutorial directly.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">However, this approach has <em>a lot</em> of limitations.</p>
</div></div>
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="why-the-initial-approach-isnt-enough">Why the Initial Approach Isn't Enough</span></h1>
</div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">Our simple semantic search implementation works, but it has several limitations that make it inadequate for serious technical content:</p>
<ol class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-decimal marker:text-indigo-400">
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Full document embeddings lose detail</strong>: When we embed entire blog posts, we're compressing thousands of words into a single 384-dimensional vector. This means specific technical details get lost.</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Code blocks get mixed with text</strong>: Technical blogs contain a mix of explanatory text and code examples. Our current approach treats both the same way, diluting the search quality.</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>No re-ranking</strong>: We're using a simple bi-encoder approach with cosine similarity, but as Ben Clavié explains, this misses the nuance that cross-encoders can provide.</p>
</li>
</ol>
</div></div>
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="chunking">Chunking</span></h1>
</div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">To address the limitations of our initial approach, we need to implement a more sophisticated solution. Following Ben Clavié's recommendations, we'll improve our system by:</p>
<ol class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-decimal marker:text-indigo-400">
<li class="leading-relaxed pl-2">Chunking our documents by markdown sections</li>
<li class="leading-relaxed pl-2">Adding keyword search capabilities (BM25)</li>
<li class="leading-relaxed pl-2">Implementing a re-ranking step</li>
</ol>
<p class="text-lg leading-relaxed mb-6 text-gray-800">Let's start with the chunking strategy, which will help us preserve more context and detail:</p>
</div></div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">There are a plethora of chunking strategies you can test, but lets use the most obvious one.  Let's use the chunks defined by the author of the article, and split on markdown headers.</p>
<blockquote class="pl-6 border-l-4 border-gradient-to-b from-indigo-400 to-purple-400 
        italic mb-6 text-gray-700 py-2 bg-gradient-to-r from-purple-50 to-transparent">
<p class="text-lg leading-relaxed mb-6 text-gray-800">Note: There's lots of discussions on optimal chunk length, and overlap, and different ways to split it.  I recommend starting with what makes sense, and then try out different ones.</p>
</blockquote>
</div></div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">def chunk_by_markdown_sections(markdown_text, min_length=250):
    &quot;&quot;&quot;Split markdown text into chunks based on header sections.&quot;&quot;&quot;
    lines = markdown_text.split(&#x27;\n&#x27;)
    chunks = []
    current_chunk = []
    current_title = &quot;Introduction&quot;
    
    for line in lines:
        if line.startswith(&#x27;#&#x27;):  # New header found
            # Save previous chunk if it&#x27;s substantial
            if current_chunk and len(&#x27;\n&#x27;.join(current_chunk)) &gt;= min_length:
                chunks.append({&#x27;title&#x27;: current_title, &#x27;content&#x27;: &#x27;\n&#x27;.join(current_chunk)})
            
            # Start new chunk
            current_title = line.lstrip(&#x27;# &#x27;)
            current_chunk = [line]
        else:
            current_chunk.append(line)
    
    # Add the final chunk if it exists and meets length requirement
    if current_chunk and len(&#x27;\n&#x27;.join(current_chunk)) &gt;= min_length:
        chunks.append({&#x27;title&#x27;: current_title, &#x27;content&#x27;: &#x27;\n&#x27;.join(current_chunk)})
    
    return chunks</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">chunk_by_markdown_sections(&quot;&quot;&quot;# Markdown\n# Chunked\n## Based on markdown\n## Headers for RAG&quot;&quot;&quot;, min_length=1)</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4">
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">[{&#x27;title&#x27;: &#x27;Markdown&#x27;, &#x27;content&#x27;: &#x27;# Markdown&#x27;},
 {&#x27;title&#x27;: &#x27;Chunked&#x27;, &#x27;content&#x27;: &#x27;# Chunked&#x27;},
 {&#x27;title&#x27;: &#x27;Based on markdown&#x27;, &#x27;content&#x27;: &#x27;## Based on markdown&#x27;},
 {&#x27;title&#x27;: &#x27;Headers for RAG&#x27;, &#x27;content&#x27;: &#x27;## Headers for RAG&#x27;}]</p>
                       </div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">Now let's apply this chunking function to our blog posts:</p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">all_chunks = []
for i, row in df.iterrows():
    for chunk in chunk_by_markdown_sections(row[&#x27;content&#x27;]):
        all_chunks.append({
            &#x27;post_title&#x27;: row[&#x27;title&#x27;], 
            &#x27;chunk_title&#x27;: chunk[&#x27;title&#x27;],
            &#x27;content&#x27;: chunk[&#x27;content&#x27;],
            &#x27;vector&#x27;: model.encode(chunk[&#x27;content&#x27;], normalize_embeddings=True)})

# Create DataFrame with all chunks
chunks_df = pd.DataFrame(all_chunks)</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">The most important thing to learn from this entire guide is that when you do things, you should <strong>look at your data</strong>.  Don't assume things were right.  Don't assume your idea made sense.  Print it out and look!</p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">for i,r in chunks_df.iterrows():
    print(r.content)
    print(&quot;-----\n&quot;)
    if i==2: break</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4"><pre ><code class=''># Intro

This post will cover how to render markdown using zero-md in FastHTML in a practical example. This includes:

  * Defining a custom HTML tag in FastHTML
  * Using external CSS and javascript libraries with FastHTML
  * Adding CSS styling
  * Organize UI into columns

In this tutorial we will convert a markdown of an early lesson in the boot.dev curriculum and a fake conversation between a student and a chatbot about the lesson to HTML. Boot.dev is an online learning platform that offers self-paced, gamified courses for back-end web development.

-----

# Markdown With Zero-md

[code]

    # Import style 1 
    from fasthtml.common import *
    from functools import partial
    
    # Import style 2
    from fasthtml.core import P, Script, Html, Link, Div, Template, Style, to_xml
    from fasthtml.components import show
[/code]

In FastHTML we can use the `P` function to put text in a paragraph `&lt;p&gt;&lt;/p&gt;` tag (a common way of displaying text). However, markdown is not rendered properly and is hard to read!

While text can be read without styling, markdown has headers, code, bullets and other elements. So we need something more than just a regular text rendering.

We need to convert markdown formatting into a format that HTML understands. We can use a javascript library called zero-md to do this, but this tag does not have a function in FastHTML. There are still two options for using this tag in FastHTML.

&gt; ### 💡 What is zero-md?
&gt;
&gt; In web development, HTML defines the general structure of a web page. However, HTML alone is usually not sufficient. Javascript allows us to extend what we can do beyond out-of-the-box HTML. `zero-md` is a Javascript library that adds functionality for displaying markdown content that we can use with an HTML tag.

The first option is to write the HTML in a text string and use that.

[code]

    NotStr(f&#x27;&#x27;&#x27;&lt;zero-md&gt;&lt;script type=&quot;text/markdown&quot;&gt;{lesson_content}&lt;/script&gt;&lt;/zero-md&gt;&#x27;&#x27;&#x27;)
    
[/code]

&gt; ### 💡 Tip
&gt;
&gt; `NotStr` is a FastHTML function designed for passing a string that should be executed as HTML code rather than a string. In the example above, because `NotStr` is used, FastHTML will treat it as HTML code rather than a Python string. If we removed the `NotStr`, all the HTML tags would be displayed on the page just as they are written rather than being rendered nicely for your web application.

This is fine for very simple things, but the more you build, the messier and harder it gets to work with. It is better to create a FastHTML style tag that works just like everything else. It&#x27;s incredibly simple to create a custom tag. By importing from `fasthtml.components` the HTML tag will be created automatically (defined in the module&#x27;s `__getattr__`).

[code]

    from fasthtml.components import Zero_md
[/code]

Now that we have our custom tag defined, we can use that with the `&lt;script&gt;` tag (included in FastHTML) to apply the formatting per the zero-md documentation. For now, we will use the defaults and do nothing with CSS (more details on this later).

[code]

    def render_local_md(md, css = &#x27;&#x27;):
        css_template = Template(Style(css), data_append=True)
        return Zero_md(css_template, Script(md, type=&quot;text/markdown&quot;))
    
    lesson_content_html = render_local_md(lesson_content)
    print(to_xml(lesson_content_html))
[/code]

[code]

    &lt;zero-md&gt;&lt;template data-append&gt;    &lt;style&gt;&lt;/style&gt;
    &lt;/template&gt;&lt;script type=&quot;text/markdown&quot;&gt;# Startup bug
    
    A new startup has a bug in its server code. The code is supposed to print messages indicating the server has started successfully.
    
    ## Challenge
    
    Fix the 2 errors in the code and get it to run!
    
    ```python
    print(&amp;quot;Starting up server...&amp;#x27;)
    prnt(&amp;quot;local server is listening on port 8080&amp;quot;)
    ```&lt;/script&gt;&lt;/zero-md&gt;
    
[/code]

The last thing we need to do is load zero-md from a CDN. We can do this by adding a `&lt;script&gt;` tag to the `&lt;head&gt;` of the HTML, and it all works!

[code]

    with open(&#x27;static/_readme.md&#x27;) as f: lesson_content = f.read()
    
    zeromd_headers = [Script(type=&quot;module&quot;, src=&quot;https://cdn.jsdelivr.net/npm/zero-md@3?register&quot;)]
[/code]

`Html(*zeromd_headers, lesson_content_html)`

-----

# Markdown Conversation Bubbles

We will start with default DaisyUI chat bubbles. For many types of conversations this is fine, but for this use case we need markdown to render properly for code snippets and structural elements.

&gt; ### 💡 Note
&gt;
&gt; This part of the tutorial picks up where the step-by-step the DaisyUI example in the FastHTML documentation leaves off. For more information, start there!
[code]

    #loading messages
    import json
    with open(&#x27;static/conversation.json&#x27;) as f:
        messages = json.load(f)[&#x27;messages&#x27;]
[/code]

[code]

    # Loading tailwind and daisyui
    chat_headers = [Script(src=&quot;https://cdn.tailwindcss.com&quot;),
               Link(rel=&quot;stylesheet&quot;, href=&quot;https://cdn.jsdelivr.net/npm/daisyui@4.11.1/dist/full.min.css&quot;)]
[/code]

We re-use the code from the daisyUI example with one change. We are using the `render_local_md` function we defined.

[code]

    # Functionality identical to Daisy UI example linked above
    def ChatMessage(msg, render_md_fn=lambda x: x):
        md = render_md_fn(msg[&#x27;content&#x27;])
        return Div(
            Div(msg[&#x27;role&#x27;], cls=&quot;chat-header&quot;),
            Div(md, cls=f&quot;chat-bubble chat-bubble-{&#x27;primary&#x27; if msg[&#x27;role&#x27;] == &#x27;user&#x27; else &#x27;secondary&#x27;}&quot;),
            cls=f&quot;chat chat-{&#x27;end&#x27; if msg[&#x27;role&#x27;] == &#x27;user&#x27; else &#x27;start&#x27;}&quot;)
[/code]

Using this, markdown doesn&#x27;t render properly, causing readability issues.

Instead let&#x27;s do exactly what we did before with Zero-md. Our markdown renders, however there are some issues with css styles clashing.

[code]

    chat_bubble =Html(*(chat_headers+zeromd_headers), ChatMessage(messages[1], render_md_fn=render_local_md))
[/code]

We can inject CSS styling to handle this issue by telling zero-md to use a template and ignore the default styles to make beautiful properly rendered conversations.

&gt; ### 💡 Tip
&gt;
&gt; CSS allows us to extend what we can do with just HTML by providing a syntax for adding styling to HTML elements in a programmatic way. You may want every header to have a specific text color or every paragraph to have a specific background color. CSS allows us to do that.
[code]

    css = &#x27;.markdown-body {background-color: unset !important; color: unset !important;}&#x27;
    _render_local_md = partial(render_local_md, css=css)
    chat_bubble = Html(*(chat_headers+zeromd_headers), ChatMessage(messages[1], render_md_fn=_render_local_md))
[/code]

Now that it looks good we can apply this style to all messages

-----

</code></pre></div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">Now we can create a new LanceDB table with our chunked content:</p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">chunk_table = db.create_table(&quot;blog_chunks&quot;, data=chunks_df, mode=&quot;overwrite&quot;)</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">We can then query to find the most relevant chunks instead of entire documents.</p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">results = chunk_table.search(query_embedding).metric(&#x27;cosine&#x27;).to_pandas()

# Print results
for _, row in results.iterrows():
    print(f&quot;Distance: {row[&#x27;_distance&#x27;]:.2f}&quot;)
    print(f&quot;Post: {row[&#x27;post_title&#x27;]} : {row[&#x27;chunk_title&#x27;]}&quot;)
    print(&#x27;---&#x27;)
    if _==2: break</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4"><pre ><code class=''>Distance: 0.63
Post: Creating Custom FastHTML Tags for Markdown Rendering : Intro
---
Distance: 0.64
Post: Creating Custom FastHTML Tags for Markdown Rendering : Putting it Together
---
Distance: 0.66
Post: Creating Custom FastHTML Tags for Markdown Rendering : Markdown With Zero-md
---
</code></pre></div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">This chunking approach gives us several advantages:</p>
<ol class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-decimal marker:text-indigo-400">
<li class="leading-relaxed pl-2">Each vector now represents a more focused piece of content</li>
<li class="leading-relaxed pl-2">We preserve the hierarchical structure of the document</li>
<li class="leading-relaxed pl-2">We can return specific sections rather than entire posts</li>
<li class="leading-relaxed pl-2">We stay within the token limits of our embedding model</li>
</ol>
<p class="text-lg leading-relaxed mb-6 text-gray-800">In the next section, we'll enhance our retrieval system by implementing a hybrid search approach that combines vector similarity with keyword matching for more accurate results.</p>
</div></div>
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="hybrid-search">Hybrid Search</span></h1>
</div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">Now that we've improved our system with chunking, let's implement the next key improvements from Ben Clavié's recommendations:</p>
<ol class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-decimal marker:text-indigo-400">
<li class="leading-relaxed pl-2">Adding keyword search (BM25) alongside vector search</li>
<li class="leading-relaxed pl-2">Implementing a re-ranking step</li>
</ol>
<p class="text-lg leading-relaxed mb-6 text-gray-800">Let's start with implementing keyword search to complement our vector search:</p>
</div></div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">import bm25s
import numpy as np
from sklearn.preprocessing import normalize</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">BM25 is a powerful keyword-based search algorithm that works by analyzing term frequency and document length. We'll use it to complement our vector search by capturing exact keyword matches that semantic search might miss.</p>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">tokenized_chunks = [doc.split() for doc in chunks_df[&#x27;content&#x27;]]</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">def hybrid_search(query, top_k=5, vector_weight=0.7):
    &quot;&quot;&quot;Perform hybrid search using both vector similarity and BM25 keyword matching.&quot;&quot;&quot;
    # Vector search
    query_embedding = model.encode(query, normalize_embeddings=True)
    vector_results = chunk_table.search(query_embedding).metric(&#x27;cosine&#x27;).limit(top_k*2).to_pandas()
    vector_results[&#x27;vector_score&#x27;] = 1 - vector_results[&#x27;_distance&#x27;]
    
    # Keyword search with BM25s
    # Create corpus from our chunks
    corpus = chunks_df[&#x27;content&#x27;].tolist()
    
    # Tokenize the corpus and index it
    corpus_tokens = bm25s.tokenize(corpus)
    retriever = bm25s.BM25(corpus=corpus)
    retriever.index(corpus_tokens)
    
    # Tokenize the query and retrieve results
    query_tokens = bm25s.tokenize(query)
    docs, scores = retriever.retrieve(query_tokens, k=len(corpus))  # Get scores for all documents
    
    # Map BM25 scores to our dataframe indices
    bm25_scores = {i: scores[0, idx] for idx, i in enumerate(docs[0])}
    vector_results[&#x27;bm25_score&#x27;] = vector_results.index.map(
        lambda x: bm25_scores.get(x, 0) if x in bm25_scores else 0)
    
    # Normalize BM25 scores
    if vector_results[&#x27;bm25_score&#x27;].max() &gt; 0:
        vector_results[&#x27;bm25_score&#x27;] = vector_results[&#x27;bm25_score&#x27;] / vector_results[&#x27;bm25_score&#x27;].max()
    
    # Combine scores with weighting
    vector_results[&#x27;combined_score&#x27;] = (
        vector_weight * vector_results[&#x27;vector_score&#x27;] + 
        (1 - vector_weight) * vector_results[&#x27;bm25_score&#x27;])
    
    return vector_results.sort_values(&#x27;combined_score&#x27;, ascending=False).head(top_k)</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">query = &quot;How do I make web components?&quot;
results = hybrid_search(query, 6)

for _, row in results.iterrows():
    print(f&quot;Post: {row[&#x27;post_title&#x27;]}&quot;)
    print(f&quot;Section: {row[&#x27;chunk_title&#x27;]}&quot;)
    print(f&quot;Relevance: {row[&#x27;combined_score&#x27;]:.2f}&quot;)
    print(&quot;---&quot;)
    if _==2: break</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4">
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">Split strings:   0%|          | 0/66 [00:00&lt;?, ?it/s]</p>
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">BM25S Count Tokens:   0%|          | 0/66 [00:00&lt;?, ?it/s]</p>
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">BM25S Compute Scores:   0%|          | 0/66 [00:00&lt;?, ?it/s]</p>
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">Split strings:   0%|          | 0/1 [00:00&lt;?, ?it/s]</p>
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">BM25S Retrieve:   0%|          | 0/1 [00:00&lt;?, ?it/s]</p>
<pre ><code class=''>Post: Creating Custom FastHTML Tags for Markdown Rendering
Section: Intro
Relevance: 0.26
---
Post: Creating Custom FastHTML Tags for Markdown Rendering
Section: Putting it Together
Relevance: 0.25
---
Post: Creating Custom FastHTML Tags for Markdown Rendering
Section: Markdown With Zero-md
Relevance: 0.24
---
</code></pre>                       </div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="re-ranking">Re-ranking</span></h1>
</div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">So far with Vector Search a model takes in a piece of text and creates a representation of that output.  This is really fast in practice because all of the documents you want to search against can have these vectors pre-calculated.  Their vector representation doesn't change regardless of the user query so we calculated them up front and stored them in LanceDB.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">However, cross-encoders make more powerful vector embeddings.  It accomplished this by examining each <strong>query-document pair</strong> in context, which helps it understand nuanced relationships that might be missed by the initial retrieval step. For example, it can better understand when a document answers a question even if it uses different terminology.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">The process works in two stages:</p>
<ol class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-decimal marker:text-indigo-400">
<li class="leading-relaxed pl-2">We use our hybrid search (vector + BM25) to efficiently retrieve a set of candidate chunks</li>
<li class="leading-relaxed pl-2">We then apply the more computationally expensive cross-encoder to re-rank these candidates</li>
</ol>
<p class="text-lg leading-relaxed mb-6 text-gray-800">This approach gives us the best of both worlds - the efficiency of bi-encoders for initial retrieval and the accuracy of cross-encoders for final ranking.</p>
</div></div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">from rerankers import Reranker
ranker = Reranker(&#x27;cross-encoder&#x27;, model=&#x27;mixedbread-ai/mxbai-rerank-base-v1&#x27;,verbose=False)</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4"><pre ><code class=''>Loading default cross-encoder model for language en
Warning: Model type could not be auto-mapped with the defaults list. Defaulting to TransformerRanker.
If your model is NOT intended to be ran as a one-label cross-encoder, please reload it and specify the model_type! Otherwise, you may ignore this warning. You may specify `model_type=&#x27;cross-encoder&#x27;` to suppress this warning in the future.
</code></pre></div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><blockquote class="pl-6 border-l-4 border-gradient-to-b from-indigo-400 to-purple-400 
        italic mb-6 text-gray-700 py-2 bg-gradient-to-r from-purple-50 to-transparent">
<p class="text-lg leading-relaxed mb-6 text-gray-800">💡 A good safe bet (today) is to use <a href="https://cohere.com/rerank" class="text-indigo-600 hover:text-indigo-800 underline decoration-2 decoration-indigo-200 hover:decoration-indigo-500 transition-all duration-300">Cohere Rerank</a> for an API for reranking.  I'm not using this for this blog post because it requires an API key and it's not neccesary for this intro tutorial, but something you should look into!</p>
</blockquote>
</div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">def search_blog_posts(query, top_k=3):
    &quot;Search blog posts using hybrid search followed by cross-encoder reranking&quot;
    # Get candidates with hybrid search
    candidates = hybrid_search(query, top_k=top_k*2)
    
    # Rerank candidates
    texts = candidates[&#x27;content&#x27;].tolist()
    doc_ids = candidates.index.tolist()
    ranked = ranker.rank(query=query, docs=texts, doc_ids=doc_ids)
    
    # Map scores back to candidates and return top results
    candidates[&#x27;rerank_score&#x27;] = candidates.index.map(
        {r.document.doc_id: r.score for r in ranked.results}.get)
    return candidates.sort_values(&#x27;rerank_score&#x27;, ascending=False).head(top_k)</code></pre>                     </div>
                   </div>
                 </div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">query = &quot;How do I make web components?&quot;
results = search_blog_posts(query)</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4">
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">Split strings:   0%|          | 0/66 [00:00&lt;?, ?it/s]</p>
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">BM25S Count Tokens:   0%|          | 0/66 [00:00&lt;?, ?it/s]</p>
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">BM25S Compute Scores:   0%|          | 0/66 [00:00&lt;?, ?it/s]</p>
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">Split strings:   0%|          | 0/1 [00:00&lt;?, ?it/s]</p>
                         <p class="text-lg leading-relaxed mb-6 text-gray-800">BM25S Retrieve:   0%|          | 0/1 [00:00&lt;?, ?it/s]</p>
                       </div>
                     </footer>
                   </article>
                 </div>
                 <div class="code-section my-6">
                   <div class="my-6">
                     <div class="code-block">
<pre class="code-block"><code class="language-python">for _, row in results.iterrows():
    print(f&quot;Post: {row[&#x27;post_title&#x27;]}&quot;)
    print(f&quot;Section: {row[&#x27;chunk_title&#x27;]}&quot;)
    print(f&quot;Relevance: {row[&#x27;rerank_score&#x27;]:.2f}&quot;)
    print(&quot;---&quot;)</code></pre>                     </div>
                   </div>
                   <article class="border border-indigo-100 rounded-xl shadow-sm bg-white overflow-x-auto">
                     <footer>
                       <div class="p-4"><pre ><code class=''>Post: Creating Custom FastHTML Tags for Markdown Rendering
Section: Putting it Together
Relevance: 0.01
---
Post: Creating Custom FastHTML Tags for Markdown Rendering
Section: Markdown With Zero-md
Relevance: -1.34
---
Post: Creating Custom FastHTML Tags for Markdown Rendering
Section: Markdown Conversation Bubbles
Relevance: -2.31
---
</code></pre></div>
                     </footer>
                   </article>
                 </div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">While our hybrid search with re-ranking is already a significant improvement, this are still lots of improvements that can be made.</p>
</div>
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="key-takeaways-and-principles">Key Takeaways and Principles</span></h1>
</div>
                 <div class="prose-section my-4"><ol class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-decimal marker:text-indigo-400">
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Semantic search isn't magic</strong> - It's about transforming text into numbers that capture meaning. These numerical representation are flawed and cannot be relied on exclusively for every type of query.</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Domain Knowledge is king</strong> - Understanding your specific domain and content type allows you to make intelligent decisions.  Be a user of your own system and actually query and see responses.  Do this A LOT.  This allows you to start with a simple approach, identifying limitations, and systematically addressing them with targeted improvements.</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Hybrid approaches outperform single methods</strong> - There is no magic answer that fixes all problems.  A combination of vector search, keyword matching, and re-ranking provides significantly better results than any single approach alone. But this is just the basics and there are many more things to add based on use-case.</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Chunking matters</strong> - How you divide your content has a huge impact on retrieval quality and user experience. The chunks should be meaningful units that preserve context while remaining focused enough to be useful.  After chunking, look at them to see if they make sense!</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>The bi-encoder/cross-encoder pattern is widely applicable</strong> - The pattern of using a fast but less accurate method for initial retrieval, followed by a slower but more accurate method for refinement is super powerful</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Evaluation is essential</strong> - Though we didn't cover it in this tutorial, having a way to measure search quality is critical for ongoing improvement. What gets measured <del>gets</del>can be improved.</p>
</li>
</ol>
</div>
                 <div class="prose-section my-4"><h1 class="text-4xl font-bold mt-12 mb-6 gradient-text-primary"><span id="next-steps">Next Steps</span></h1>
</div>
                 <div class="prose-section my-4"><p class="text-lg leading-relaxed mb-6 text-gray-800">If you've followed along to this point, you now have a powerful semantic search system for your blog posts. But there's <strong>massive</strong> room for growth and experimentation:</p>
</div>
                 <div class="prose-section my-4"><h2 class="text-3xl font-bold mt-10 mb-5 gradient-text-secondary"><span id="extend-your-implementation">Extend Your Implementation</span></h2>
</div>
                 <div class="prose-section my-4"><ul class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-disc marker:text-indigo-400">
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Add Metadata Filtering</strong>: Enable users to narrow results by programming language, difficulty level, or post type (e.g., "Show me only Python tutorials for beginners").</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Add Multi-Modal Search</strong>: Incorporate images, diagrams, and code snippets in your search index to find visual explanations alongside text (e.g., "Find me posts with architecture diagrams for microservices").</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Add Evaluation Framework</strong>: Build a systematic way to measure search quality with metrics like precision and recall to continuously improve your system.  Create implicit evaluation (link tracking) or user feedback systems.</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Add Query Pre-processing</strong>: Identify and prioritize technical terms and entities in user queries to better match domain-specific content (e.g., recognizing "React hooks" as a specific technical concept).</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Add Query Classification</strong>: Detect the intent behind searches to provide more tailored results (e.g., distinguishing between "how to" tutorials vs conceptual explanations).</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Add Query Expansion</strong>: Automatically add related technical terms to queries to improve recall (e.g., expanding "web components" to include "custom elements" and "shadow DOM").</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>Experiment with different chunking strategies</strong>: Test different chunking strategies and sizes to find the optimal balance between context preservation and specificity for your content.</p>
</li>
<li class="leading-relaxed pl-2">
<p class="text-lg leading-relaxed mb-6 text-gray-800"><strong>"More Like This" Functionality</strong>: Allow users to find similar content to a post they're already reading, creating a natural exploration path through your technical content.</p>
</li>
</ul>
</div>
                 <div class="prose-section my-4"><h2 class="text-3xl font-bold mt-10 mb-5 gradient-text-secondary"><span id="resources-for-further-learning">Resources for Further Learning</span></h2>
</div>
                 <div class="prose-section my-4"><ul class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-disc marker:text-indigo-400">
<li class="leading-relaxed pl-2"><a href="https://lancedb.github.io/lancedb/" class="text-indigo-600 hover:text-indigo-800 underline decoration-2 decoration-indigo-200 hover:decoration-indigo-500 transition-all duration-300">LanceDB Documentation</a> - Dive deeper into vector database capabilities</li>
<li class="leading-relaxed pl-2"><a href="https://www.sbert.net/" class="text-indigo-600 hover:text-indigo-800 underline decoration-2 decoration-indigo-200 hover:decoration-indigo-500 transition-all duration-300">Sentence Transformers Library</a> - Explore more embedding models and fine-tuning</li>
<li class="leading-relaxed pl-2"><a href="https://parlance-labs.com/education/rag/ben.html" class="text-indigo-600 hover:text-indigo-800 underline decoration-2 decoration-indigo-200 hover:decoration-indigo-500 transition-all duration-300">Ben Clavié's RAG Talk</a> - The inspiration for many techniques in this post</li>
<li class="leading-relaxed pl-2"><a href="https://huggingface.co/spaces/mteb/leaderboard" class="text-indigo-600 hover:text-indigo-800 underline decoration-2 decoration-indigo-200 hover:decoration-indigo-500 transition-all duration-300">MTEB Leaderboard</a> - Compare embedding model performance</li>
<li class="leading-relaxed pl-2"><a href="https://github.com/AnswerDotAI/rerankers" class="text-indigo-600 hover:text-indigo-800 underline decoration-2 decoration-indigo-200 hover:decoration-indigo-500 transition-all duration-300">Rerankers Library</a> - Explore more re-ranking options</li>
</ul>
</div>
                 <div class="prose-section my-4"><h2 class="text-3xl font-bold mt-10 mb-5 gradient-text-secondary"><span id="join-the-conversation">Join the Conversation</span></h2>
</div>
                 <div class="prose-section my-4"><div><p class="text-lg leading-relaxed mb-6 text-gray-800">I'd love to hear about your experiences implementing semantic search:</p>
<ul class="space-y-3 mb-6 ml-6 text-lg text-gray-800 list-disc marker:text-indigo-400">
<li class="leading-relaxed pl-2">What chunking strategies worked best for your content?</li>
<li class="leading-relaxed pl-2">Which embedding models performed best in your domain?</li>
<li class="leading-relaxed pl-2">What unexpected challenges did you encounter?</li>
</ul>
<p class="text-lg leading-relaxed mb-6 text-gray-800">Share your implementation, ask questions, or suggest improvements in the comments below or reach out on Twitter/X @isaac_flath.</p>
<p class="text-lg leading-relaxed mb-6 text-gray-800">Remember, the field of semantic search and retrieval is evolving rapidly. The techniques we've covered provide a solid foundation, but staying curious and experimental will keep your system at the cutting edge.</p>
</div></div>
                 <div class="bg-gray-50 p-6 rounded-xl mt-12 border border-gray-200">
                   <h3 class="text-xl font-semibold mb-2 text-gray-900">Stay Updated</h3>
                   <p class="text-gray-600 mb-4">Get notified about new posts on AI, web development, and tech insights.</p>
<form enctype="multipart/form-data" action="https://app.convertkit.com/forms/7782268/subscriptions" method="post" data-sv-form="7782268" data-uid="33bc264078" data-format="inline" data-version="5" class="seva-form formkit-form">                     <div class="flex">
                       <input type="email" name="email_address" placeholder="Enter your email" required class="w-full md:w-64 px-4 py-2 rounded-l-lg border border-r-0 border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent">
<button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-r-lg hover:bg-indigo-700 transition-colors duration-200">Subscribe</button>                     </div>
</form>                 </div>
               </div>
               <div class="hidden lg:block lg:w-80 lg:flex-shrink-0 lg:ml-8 lg:sticky lg:top-4 lg:self-start">
                 <div class="
            bg-gray-50 rounded-xl p-6
            border border-gray-200
            max-h-[calc(100vh-2rem)] overflow-y-auto
        ">
                   <h2 class="text-lg font-medium text-gray-900 mb-4">Contents</h2>
                   <div id="toc-list" class="space-y-1 border-l-2 border-gray-200">
<a href="#the-challenge-of-finding-relevant-content" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">The Challenge of Finding Relevant Content</a><a href="#what-this-post-will-deliver" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">What This Post Will Deliver</a><a href="#vector-embeddings-the-key-to-semantic-search" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Vector Embeddings: The Key to Semantic Search</a><a href="#initial-solution-attempt-setting-up-lancedb" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Initial Solution Attempt: Setting Up LanceDB</a><a href="#why-the-initial-approach-isnt-enough" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Why the Initial Approach Isn&#x27;t Enough</a><a href="#chunking" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Chunking</a><a href="#hybrid-search" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Hybrid Search</a><a href="#re-ranking" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Re-ranking</a><a href="#key-takeaways-and-principles" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Key Takeaways and Principles</a><a href="#next-steps" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-semibold
                          ml-0
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Next Steps</a><a href="#extend-your-implementation" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-normal
                          ml-4
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Extend Your Implementation</a><a href="#resources-for-further-learning" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-normal
                          ml-4
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Resources for Further Learning</a><a href="#join-the-conversation" class="
                          block text-sm text-gray-600 hover:text-indigo-600 
                          font-normal
                          ml-4
                          py-2 border-l-2 pl-4
                          hover:border-indigo-500 border-transparent
                          transition-all duration-200
                      ">Join the Conversation</a>                   </div>
                 </div>
               </div>
             </div>
           </div>
<script>
            document.addEventListener('DOMContentLoaded', function() {
                // Highlight all code blocks
                Prism.highlightAll();
            });
        </script>         </div>
       </div>
       <section class="bg-gradient-to-b from-purple-50 to-indigo-50 mt-12">
         <div class="max-w-4xl mx-auto px-4">
           <div class="h-1 w-full bg-gradient-to-r from-indigo-300 via-purple-200 to-pink-200 mb-8 shadow-[0_0_15px_rgba(165,180,252,0.3)]"></div>
           <div class="space-y-4 py-8">
             <div class="flex justify-center">
               <h2 class="text-3xl font-bold text-center mb-6 bg-gradient-to-r from-indigo-400 to-purple-400 inline-block text-transparent bg-clip-text">Let&#x27;s Connect</h2>
             </div>
             <div class="flex gap-4 justify-center flex-wrap">
<a href="https://github.com/isaac-flath" class="px-6 py-3 rounded-lg bg-white/90 text-indigo-700 hover:bg-indigo-50 hover:scale-105 transform transition-all duration-300 hover:shadow-[0_0_15px_rgba(165,180,252,0.3)] border border-indigo-100">                 <div class="flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-6 h-6 text-indigo-400"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.237 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><span class="ml-2">GitHub</span>                 </div>
</a><a href="https://linkedin.com/in/isaacflath" class="px-6 py-3 rounded-lg bg-white/90 text-indigo-700 hover:bg-indigo-50 hover:scale-105 transform transition-all duration-300 hover:shadow-[0_0_15px_rgba(192,132,252,0.3)] border border-indigo-100">                 <div class="flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-6 h-6 text-purple-400"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg><span class="ml-2">LinkedIn</span>                 </div>
</a><a href="https://x.com/isaac_flath" class="px-6 py-3 rounded-lg bg-white/90 text-indigo-700 hover:bg-indigo-50 hover:scale-105 transform transition-all duration-300 hover:shadow-[0_0_15px_rgba(244,114,182,0.3)] border border-indigo-100">                 <div class="flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-6 h-6 text-pink-400"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg><span class="ml-2">Twitter</span>                 </div>
</a>             </div>
             <p class="mt-8 text-sm text-indigo-600/70 text-center">© 2025 Isaac Flath • All rights reserved</p>
           </div>
         </div>
       </section>
     </div>
   </body>
 </html>
